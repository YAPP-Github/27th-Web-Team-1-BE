domain {
    encode zstd gzip

    @allowed_origins {
        header Origin ^(http://localhost:3000|https://localhost:3000|https://develop\.lokit\.co\.kr|https://develop-api\.lokit\.co\.kr|https://local\.lokit\.co\.kr:3000|https://kauth\.kakao\.com|https://kapi\.kakao\.com)$
    }

    @cors_preflight {
        method OPTIONS
        path /api/*
    }

    handle @cors_preflight {
        header Access-Control-Allow-Origin "{http.request.header.Origin}"
        header Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS"
        header Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, Accept, Origin, X-API-VERSION, X-Admin-Key, X-Idempotency-Key"
        header Access-Control-Allow-Credentials "true"
        header Access-Control-Max-Age "86400"
        respond 204
    }

    header @allowed_origins {
        Access-Control-Allow-Origin "{http.request.header.Origin}"
        Access-Control-Allow-Credentials "true"
        Vary Origin
    }

    reverse_proxy /api/* localhost:8080
}
